import{_ as f,r as v,c as i,d as a,f as h,j as r,v as d,ae as g,ac as _,e as P,h as u,s as n}from"./index-BirWHe53.js";import{S as y}from"./config-DBxA65oN.js";const N={class:"account-edit-bg"},k={class:"account-edit-card"},V={class:"edit-group"},E=["disabled"],x={class:"edit-group"},S=["disabled"],B={class:"edit-group"},T={key:0,class:"required"},U=["disabled"],C={class:"edit-group"},$=["disabled"],j=["disabled"],A={key:0},M={key:1},R={__name:"AccountEditView",setup(I){const p=P(),e=v({email:"",phoneNumber:"",currentPassword:"",newPassword:""}),t=v(!1);function w(){if(e.value.email&&!/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(e.value.email))return n.warning("请输入有效邮箱"),!1;if(e.value.phoneNumber&&!/^1[3-9]\d{9}$/.test(e.value.phoneNumber))return n.warning("请输入正确手机号"),!1;if(e.value.newPassword){if(!e.value.currentPassword)return n.warning("修改密码需输入原密码"),!1;if(e.value.newPassword.length<6||e.value.newPassword.length>32)return n.warning("新密码长度应为6-32位"),!1}return!e.value.email&&!e.value.phoneNumber&&!e.value.newPassword?(n.warning("请至少填写一项要修改的信息"),!1):!0}async function m(){if(w()){t.value=!0;try{const o=localStorage.getItem("token"),s={};e.value.email&&(s.email=e.value.email),e.value.phoneNumber&&(s.phoneNumber=e.value.phoneNumber),e.value.newPassword&&(s.currentPassword=e.value.currentPassword,s.newPassword=e.value.newPassword);const c=await(await fetch(`http://${y}/api/user/update`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(s)})).json();c.code===200?(n.success("修改成功"),p.back()):n.error(c.message||"修改失败")}catch(o){n.error("网络错误"),console.error(o)}finally{t.value=!1}}}function b(){p.back()}return(o,s)=>(u(),i("div",N,[a("div",k,[a("div",{class:"edit-header"},[a("button",{class:"back-btn",onClick:b},"返回"),s[4]||(s[4]=a("h2",null,"修改账户信息",-1))]),a("form",{class:"edit-form",onSubmit:h(m,["prevent"])},[a("div",V,[s[5]||(s[5]=a("label",null,"新邮箱",-1)),r(a("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>e.value.email=l),type:"email",placeholder:"请输入新邮箱",class:"edit-input",disabled:t.value},null,8,E),[[d,e.value.email]])]),a("div",x,[s[6]||(s[6]=a("label",null,"新手机号",-1)),r(a("input",{"onUpdate:modelValue":s[1]||(s[1]=l=>e.value.phoneNumber=l),type:"text",placeholder:"请输入新手机号",class:"edit-input",disabled:t.value},null,8,S),[[d,e.value.phoneNumber]])]),a("div",B,[a("label",null,[s[7]||(s[7]=g("原密码 ")),e.value.newPassword?(u(),i("span",T,"*")):_("",!0)]),r(a("input",{"onUpdate:modelValue":s[2]||(s[2]=l=>e.value.currentPassword=l),type:"password",placeholder:"如需修改密码请填写原密码",class:"edit-input",disabled:t.value},null,8,U),[[d,e.value.currentPassword]])]),a("div",C,[s[8]||(s[8]=a("label",null,"新密码",-1)),r(a("input",{"onUpdate:modelValue":s[3]||(s[3]=l=>e.value.newPassword=l),type:"password",placeholder:"请输入新密码（6-32位）",class:"edit-input",disabled:t.value},null,8,$),[[d,e.value.newPassword]])]),a("button",{class:"edit-btn",disabled:t.value},[t.value?(u(),i("span",M,"正在提交...")):(u(),i("span",A,"确认修改"))],8,j)],32)]),s[9]||(s[9]=a("div",{class:"neon-bg"},[a("div",{class:"neon-light neon-light-1"}),a("div",{class:"neon-light neon-light-2"}),a("div",{class:"neon-light neon-light-3"})],-1))]))}},z=f(R,[["__scopeId","data-v-66e34136"]]);export{z as default};
